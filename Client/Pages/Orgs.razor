@page "/orgs"

<div class="text-center mb-4">
    <h2 class="fw-bold">Search Pet Adoption Rescues</h2>
    <p class="text-muted">
        Find local rescue organizations, shelters, and adoption partners near you.
        Use the search box below to get started.
    </p>
</div>

<div class="row justify-content-center">
    <div class="col-md-6 col-sm-12">
        <Client.Pages.Components.SearchBox OnSearch="OnSearch"
                                           ShowBreeds="false"
                                           AnimalSearchDto="searchDto">
        </Client.Pages.Components.SearchBox>
    </div>
</div>

<br />

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
    @foreach (var org in orgs)
    {
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">

                    <div class="fw-bold">@org.name</div>
                    <div class="card-subtitle mb-2 text-muted">
                        @org.AddressString
                        <br /><br />
                        @($"{@org.about} {@org.adoptionProcess}")
                    </div>
                    @if (!string.IsNullOrWhiteSpace(org.PhoneNumberString))
                    {
                        <p class="card-text mb-1">
                            <strong>Phone:</strong>
                            <a href="tel:@org.PhoneNumberString" class="text-decoration-none">
                                @org.PhoneNumberString
                            </a>
                        </p>
                    }
                    @if (!string.IsNullOrWhiteSpace(org.email))
                    {
                        <p class="card-text mb-1">
                            <strong>Email:</strong>
                            <a href="mailto:@org.email" class="text-decoration-none">
                                @org.email
                            </a>
                        </p>
                    }
                    @if (!string.IsNullOrWhiteSpace(org.UrlString))
                    {
                        <p class="card-text mb-1">
                            <strong>Website:</strong>
                            <a href="@org.UrlString" class="text-decoration-none">
                                @org.UrlString
                            </a>
                        </p>
                    }
                    @if (!string.IsNullOrWhiteSpace(org.DonattionUrlString))
                    {
                        <p class="card-text mb-1">
                            <strong>Donate:</strong>
                            <a href="@org.DonattionUrlString" class="text-decoration-none">
                                @org.DonattionUrlString
                            </a>
                        </p>
                    }

                    <div class="mt-3 d-flex flex-wrap gap-2">

                        @if (!string.IsNullOrWhiteSpace(org.FacebookUrlString))
                        {
                            <a href="@org.FacebookUrlString" target="_blank"
                               class="btn btn-sm btn-primary">
                                <svg height="50" width="50" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                     viewBox="0 0 474.294 474.294" xml:space="preserve">
                                <circle style="fill:#3A5A98;" cx="237.111" cy="236.966" r="236.966" />
                                <path style="fill:#345387;" d="M404.742,69.754c92.541,92.541,92.545,242.586-0.004,335.134
	                                    c-92.545,92.541-242.593,92.541-335.134,0L404.742,69.754z" />
                                <path style="fill:#2E4D72;" d="M472.543,263.656L301.129,92.238l-88.998,88.998l5.302,5.302l-50.671,50.667l41.474,41.474
	                                    l-5.455,5.452l44.901,44.901l-51.764,51.764l88.429,88.429C384.065,449.045,461.037,366.255,472.543,263.656z" />
                                <path style="fill:#FFFFFF;" d="M195.682,148.937c0,7.27,0,39.741,0,39.741h-29.115v48.598h29.115v144.402h59.808V237.276h40.134
	                                    c0,0,3.76-23.307,5.579-48.781c-5.224,0-45.485,0-45.485,0s0-28.276,0-33.231c0-4.962,6.518-11.641,12.965-11.641
	                                    c6.436,0,20.015,0,32.587,0c0-6.623,0-29.481,0-50.592c-16.786,0-35.883,0-44.306,0C194.201,93.028,195.682,141.671,195.682,148.937
	                                    z" />
                                    </svg>
                            </a>
                        }

                    </div>

                </div>
            </div>
        </div>
    }
</div>

@if (IsLoading)
{
    <div class="loading-overlay d-flex justify-content-center align-items-center">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

@code {

    [Inject]
    private Client.Services.IAdoptService adoptService { get; set; }

    private List<OrgStandard> orgs { get; set; } = new();

    private SearchParams searchDto = new();

    bool IsLoading { get; set; } = false;

    private async Task OnSearch(SearchParams searchDto)
    {
        IsLoading = true;
        StateHasChanged();

        orgs = await adoptService.GetOrgs(searchDto);
        orgs = orgs.OrderBy(a => a.distance).ToList();


        IsLoading = false;
        StateHasChanged();
    }

}
